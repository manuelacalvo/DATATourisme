<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <!-- On charge les fichiers CDN de Leaflet. Le CSS AVANT le JS -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
        <style type="text/css">
            #map{ /* la carte doit avoir une hauteur sinon elle n'apparaît pas */
                height:550px;
            }
        </style>
        <title>Carte</title>
    </head>
    <body>
        <div id="map">
        </div>
        
        <!--Champs de recherche dynamique-->
        <form autocomplete="off">
            <div class="autocomplete" style="width:300px;">
              <input id="catInput" type="text" name="categories" placeholder="Catégorie">
            </div>
            <input type="submit">
        </form>


        <!-- Fichiers Javascript -->
        <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
        
        <script type="text/javascript" src="C:\Users\Guilhem\Projet_BigData\DATATourisme\src\data\poi.js"></script>
        
        <!--Script du champs de recherche dynamique-->
        <script type="text/javascript">
        
            function autocomplete(inp, arr) {
              
              var currentFocus;
              
              inp.addEventListener("input", function(e) {
                  var a, b, i, val = this.value;
                  
                  closeAllLists();
                  if (!val) { return false;}
                  currentFocus = -1;
                  
                  a = document.createElement("DIV");
                  a.setAttribute("id", this.id + "autocomplete-list");
                  a.setAttribute("class", "autocomplete-items");
                  
                  this.parentNode.appendChild(a);
                  
                  for (i = 0; i < arr.length; i++) {
                   
                    if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                      
                      b = document.createElement("DIV");
                      
                      b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                      b.innerHTML += arr[i].substr(val.length);
                      
                      b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                      
                          b.addEventListener("click", function(e) {
                          
                          inp.value = this.getElementsByTagName("input")[0].value;
                          
                          closeAllLists();
                      });
                      a.appendChild(b);
                    }
                  }
              });
              
              inp.addEventListener("keydown", function(e) {
                  var x = document.getElementById(this.id + "autocomplete-list");
                  if (x) x = x.getElementsByTagName("div");
                  if (e.keyCode == 40) {
                    
                    currentFocus++;
                    
                    addActive(x);
                  } else if (e.keyCode == 38) { //up
                    
                    currentFocus--;
                    
                    addActive(x);
                  } else if (e.keyCode == 13) {
                    
                    e.preventDefault();
                    if (currentFocus > -1) {
                      
                      if (x) x[currentFocus].click();
                    }
                  }
              });
              function addActive(x) {
                
                if (!x) return false;
                
                removeActive(x);
                if (currentFocus >= x.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = (x.length - 1);
                
                x[currentFocus].classList.add("autocomplete-active");
              }
              function removeActive(x) {
                
                for (var i = 0; i < x.length; i++) {
                  x[i].classList.remove("autocomplete-active");
                }
              }
              function closeAllLists(elmnt) {
               
                var x = document.getElementsByClassName("autocomplete-items");
                for (var i = 0; i < x.length; i++) {
                  if (elmnt != x[i] && elmnt != inp) {
                  x[i].parentNode.removeChild(x[i]);
                }
              }
            }
           
            document.addEventListener("click", function (e) {
                closeAllLists(e.target);
            });
            }

        </script>

        
        <!--Script de la carte-->
        <script type="text/javascript">
        
            var form = document.querySelector("form");
            var cat = "";
            var categories = ["Sport et loisir","Culte","Culture","Commerce Local","Patin à glace"];
            
            autocomplete(document.getElementById("catInput"), categories);
            // Affiche de toutes les données saisies ou choisies
            form.addEventListener("submit", function (e) {

                cat = form.elements.catInput.value
                changeMarkers(points); 
                e.preventDefault(); // Annulation de l'envoi des données
            });
            // On initialise la latitude et la longitude de Paris (centre de la carte)
            var lat = 48.852969;
            var lon = 2.349903;
            var macarte = L.map('map').setView([lat, lon], 11);
            var markerGroup = L.layerGroup().addTo(macarte);


            // Fonction d'initialisation de la carte
            function initMap() {
            
	            L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
                
	        	    attribution: 'données © OpenStreetMap/ODbL - rendu OSM France',
	        	    minZoom: 1,
	        	    maxZoom: 20
                }).addTo(macarte);
                           	
            }
        
            function changeMarkers(json){
            
                markerGroup.clearLayers();
                for (poi in json) {
                    if (cat == json[poi].fields.categorie1 || cat == json[poi].fields.categorie2 || cat == json[poi].fields.categorie3)
                    {
                    
                    var marker = L.marker([json[poi].fields.latitude, json[poi].fields.longitude]).addTo(macarte);
                    var html = '';
                         if (json[poi].fields.nom) {
                             html += '<b>' + json[poi].fields.nom + '</b></br>';
                         }
                         if (json[poi].fields.description) {
                             html += 'Description :' + json[poi].fields.description + '</br>';
                         }
                         if (json[poi].fields.adresse) {
                             html += 'Adresse : ' + json[poi].fields.adresse + '</br>';
                         }
                         if (json[poi].fields.categorie1) {
                             html += 'Catégorie 1 : ' + json[poi].fields.categorie1 + '</br>';
                         }
                         if (json[poi].fields.categorie2) {
                             html += 'Catégorie 2 : ' + json[poi].fields.categorie2 + '</br>';
                         }
                         if (json[poi].fields.categorie3) {
                             html += 'Catégorie 3 : ' + json[poi].fields.categorie3 + '</br>';
                         }
                    marker.bindPopup(html);
                    marker.addTo(markerGroup);
                    }
                
                }   
            }
            window.onload = function(){
	            initMap(); 
            };



        
        </script>
    </body>
</html>